# 時間帯別背景システム実装ドキュメント

## 概要

時間帯に応じて背景が動的に変化するシステムの実装完了ドキュメント。
6つの時間帯（Dawn, Morning, Day, Afternoon, Sunset, Night）ごとに異なる背景を表示し、各時間帯の個性を表現します。

## 実装完了日

2026年2月24日

## アーキテクチャ

### コンポーネント構成

```
src/
├── components/
│   └── background/
│       └── TimedBackground.tsx      # メインの背景コンポーネント
├── hooks/
│   └── useTimeOfDay.ts             # 時間帯判定フック
├── lib/
│   └── timeOfDayConfig.ts          # 時間帯設定
└── types/
    └── global.d.ts                 # グローバル型定義
```

### 時間帯定義

| 時間帯 | 時刻範囲 | 説明 |
|--------|---------|------|
| Dawn | 5:00-6:30 | 朝焼け |
| Morning | 6:30-11:00 | 朝 |
| Day | 11:00-15:00 | 昼 |
| Afternoon | 15:00-17:30 | 午後 |
| Sunset | 17:30-19:00 | 夕焼け |
| Night | 19:00-5:00 | 夜 |

## 各時間帯の特徴

### Dawn（朝焼け）: 5:00-6:30

**ビジュアル:**
- 空: オレンジ→ピンク→紫のグラデーション
- 太陽: 地平線近く（右下）、オレンジ色
- 雲: ピンク〜オレンジ色

**アニメーション:**
- 太陽の脈動: 8秒周期、1.03倍
- 雲の速度: 0.8倍（ゆっくり）

### Morning（朝）: 6:30-11:00

**ビジュアル:**
- 空: 爽やかな青空（sky-300→blue-200→green-100）
- 太陽: 右上やや低め（20%）、明るい黄色
- 雲: 白く爽やか

**アニメーション:**
- 太陽の脈動: 7秒周期、1.025倍
- 雲の速度: 1.1倍（活発）

### Day（昼）: 11:00-15:00

**ビジュアル:**
- 空: 鮮やかな青空（sky-400→blue-300→green-200）
- 太陽: 右上高め（8%）、最も明るい
- 雲: 白く明瞭

**アニメーション:**
- 太陽の脈動: 6秒周期、1.02倍
- 雲の速度: 1.0倍（標準）

### Afternoon（午後）: 15:00-17:30

**ビジュアル:**
- 空: やや暖かみのある青空（amber-100アクセント）
- 太陽: やや西寄り（20%）、アンバー系
- 雲: 白〜薄い黄色

**アニメーション:**
- 太陽の脈動: 7秒周期、1.02倍
- 雲の速度: 0.9倍（穏やか）

### Sunset（夕焼け）: 17:30-19:00

**ビジュアル:**
- 空: オレンジ→ピンク→紫の鮮やかなグラデーション
- 太陽: 地平線近く（左下）、赤〜オレンジ
- 雲: 赤・オレンジ・黄色に染まる

**アニメーション:**
- 太陽の脈動: 9秒周期、1.035倍（最大）
- 雲の速度: 0.7倍（ゆっくり）

### Night（夜）: 19:00-5:00

**ビジュアル:**
- 空: 濃い青〜紫〜灰色（indigo-950→purple-900→slate-800）
- 月: 左上、銀白色の優しい光
- 雲: 暗い灰色
- **星空エフェクト**: 50個の輝く星

**アニメーション:**
- 月の脈動: 10秒周期、1.015倍（最小）
- 雲の速度: 0.6倍（最もゆっくり）
- 星: ランダムな瞬き

## パフォーマンス最適化

### 実装済み最適化

1. **React.memo**: 不要な再レンダリング防止
2. **useMemo**: 設定オブジェクトのメモ化
3. **GPU合成**: will-change, translateZ(0)の使用
4. **レスポンシブ雲数**: 
   - モバイル: 2個
   - タブレット: 3個
   - デスクトップ: 4個
5. **Resizeイベントのthrottling**: 200ms間隔
6. **AnimatePresence**: 効率的なDOM更新
7. **星コンポーネントのメモ化**: 位置計算の最適化

### パフォーマンス目標

- FPS: 60fps維持
- 初回レンダリング: < 100ms
- 時間帯切り替え: スムーズな2秒トランジション

## 使用方法

### 基本使用

```tsx
import { TimedBackground } from "@/components/background/TimedBackground";

export default function Page() {
  return (
    <div className="relative min-h-screen">
      <TimedBackground />
      {/* コンテンツ */}
    </div>
  );
}
```

### デバッグモード

```tsx
// 特定の時間帯を強制表示
<TimedBackground debugTimeOfDay="night" />
```

ブラウザコンソールでも設定可能:
```javascript
window.__DEBUG_TIME_OF_DAY = 'sunset';
```

## テスト

### テストページ

http://localhost:3000/test-background

### 確認項目

- [ ] 全6時間帯が正しく表示される
- [ ] 時間帯切り替えがスムーズ（2秒フェード）
- [ ] 太陽/月の脈動速度が時間帯で異なる
- [ ] 雲の移動速度が時間帯で異なる
- [ ] 夜に星空が表示される
- [ ] レスポンシブ対応（雲の数が画面サイズで変わる）
- [ ] FPSが60に近い
- [ ] SSRエラーが発生しない

## トラブルシューティング

### SSRエラー（window is not defined）

**原因**: サーバーサイドで`window`にアクセス

**解決**: `typeof window !== 'undefined'`チェック、または`useState` + `useEffect`パターン

### ハイドレーションエラー

**原因**: SSRとクライアントで初期値が異なる

**解決**: SSR時とクライアント時で同じデフォルト値を使用

### パフォーマンス低下

**原因**: 
- 雲の数が多すぎる
- アニメーションが重複
- GPU合成が無効

**解決**:
- レスポンシブ雲数の調整
- React.memoの適用範囲確認
- will-changeの設定確認

## 今後の拡張案

1. **天候システム**: 雨・雪・曇りなどの天候エフェクト
2. **季節対応**: 季節に応じた色合いの変化
3. **ユーザー設定**: 時間帯の手動選択機能
4. **パララックス効果**: スクロールに応じた背景の動き
5. **音響エフェクト**: 時間帯に応じたBGM/環境音

## 関連ファイル

- `/src/components/background/TimedBackground.tsx` - メインコンポーネント
- `/src/hooks/useTimeOfDay.ts` - 時間帯判定ロジック
- `/src/lib/timeOfDayConfig.ts` - 時間帯設定
- `/src/app/test-background/page.tsx` - テストページ
- `/docs/time-based-background-plan.md` - 実装計画書
- `/docs/debug-time-of-day.md` - デバッグ機能

## 変更履歴

### Phase 1: 基礎実装
- 6時間帯の定義
- useTimeOfDayExtended フック
- デバッグ機能

### Phase 2: コンポーネント化
- TimedBackground コンポーネント作成
- テストページ作成
- SSR対応

### Phase 3: 統合
- トップページへの統合
- 既存背景コードの削除

### Phase 4: 全時間帯実装
- Dawn, Morning, Afternoon, Sunset, Night の実装
- 各時間帯の色・位置設定

### Phase 5: 差別化
- 時間帯別アニメーション速度
- 滑らかなトランジション
- 星空エフェクト

### Phase 6: 最終調整
- パフォーマンス最適化
- ドキュメント整備
- 最終動作確認

## プロジェクトメンバー

実装: GitHub Copilot (Claude Sonnet 4.5)
レビュー: ユーザー様

---

実装完了: 2026年2月24日
