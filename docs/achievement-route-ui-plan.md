# 実績画面UI改善: 登山ルート型レイアウト実装計画

## 📋 概要

実績画面を「登山ルート」をモチーフにしたステップ形式のUIに刷新し、プレイヤーの成長過程をストーリー性のある形で可視化する。

### 目的
- 実績の達成感と進捗の視覚化を強化
- ゲームのテーマ（登山・マウンティング）との一貫性向上
- ユーザーに次の目標を明確に提示

---

## 🎯 現状の課題

### UI面
1. **単調な並び**: 縦一列のカードが続くだけで変化がない
2. **達成感の薄さ**: プログレスバーだけでは物足りない
3. **カテゴリ感の欠如**: すべてフラットに表示され、関連性が分からない
4. **次の目標が不明確**: どの実績を目指すべきかが分かりにくい

### データ面
5. **カテゴリ情報の不在**: `achievements.ts`に実績のカテゴリ情報がない
6. **順序情報の不在**: 実績の達成順序や難易度が不明確

---

## 💡 提案する改善内容

### コンセプト: 「登山ルート」

各実績カテゴリを1つの登山ルートとして表現し、プレイヤーの成長を山登りの進捗として可視化する。

```
                    🚩 世界の頂 (8000m)
                   /
                  ◆ (解除済み)
                 /
                ⛄ 銀世界 (6000m)
               /
              ◆ (解除済み)
             /
            🏔️ アルピニスト (3000m)
           /
          ◆ (解除済み)
         /
        👣 第一歩
       /
    ━━━━ ベースキャンプ
```

### UI要素

#### 1. ルートごとの縦配置
- **標高達成ルート**: 標高系の実績を下から上に配置
- **対戦ルート**: 対戦系の実績を別ルートとして配置
- **特殊ルート**: その他の実績（未実装含む）

#### 2. ステップの視覚表現
- **解除済み**: アイコン + タイトル + 接続線（明るい色）
- **次の目標**: 強調表示 + 達成条件の明示
- **未到達**: グレーアウト + ロックアイコン

#### 3. インタラクティブ要素
- **ホバー/タップ**: 詳細情報をツールチップまたはモーダルで表示
- **アニメーション**: 解除時のエフェクト（将来実装）
- **進捗表示**: 各ルートの達成率

---

## 🏗️ 技術的なアプローチ

### 1. データ構造の拡張

#### `src/lib/achievements.ts` に追加

```typescript
export type AchievementCategory = 
  | "altitude"    // 標高達成系
  | "versus"      // 対戦系
  | "special";    // 特殊系

export type Achievement = {
  id: AchievementId;
  title: string;
  description: string;
  icon?: string;
  category: AchievementCategory;  // ✅ 追加
  order: number;                   // ✅ 追加（ルート内での順序）
  requiredValue?: number;          // ✅ 追加（達成条件の値）
};

// カテゴリごとにグループ化するヘルパー
export function groupAchievementsByCategory(): Record<AchievementCategory, Achievement[]> {
  const grouped: Record<AchievementCategory, Achievement[]> = {
    altitude: [],
    versus: [],
    special: [],
  };
  
  ACHIEVEMENTS.forEach(ach => {
    grouped[ach.category].push(ach);
  });
  
  // 各カテゴリ内で order 順にソート
  Object.keys(grouped).forEach(cat => {
    grouped[cat as AchievementCategory].sort((a, b) => a.order - b.order);
  });
  
  return grouped;
}
```

### 2. コンポーネント設計

#### 新規コンポーネント

```
src/components/achievements/
├── AchievementRoute.tsx          # 1つのルート全体
├── AchievementStep.tsx           # 1つの実績ステップ
├── RouteConnector.tsx            # ステップ間の接続線
└── AchievementDetailModal.tsx   # 詳細モーダル（オプション）
```

#### `AchievementRoute.tsx`
- ルートタイトル（カテゴリ名）
- 進捗表示（例: 3/5）
- ステップのリスト（下から上）

#### `AchievementStep.tsx`
- アイコン表示
- ロック/解除状態
- ホバー時の詳細表示
- 「次の目標」のハイライト

#### `RouteConnector.tsx`
- ステップ間の視覚的な接続線
- 解除済み部分は明るく、未達成は暗く

---

## 📐 詳細設計

### レイアウト

#### デスクトップ (md以上)
```
┌────────────────────────────────────────┐
│         🏆 実績一覧                     │
│   あなたのマウンティングの記録です       │
├────────────────────────────────────────┤
│                                        │
│  ┌─────────┐  ┌─────────┐  ┌────────┐ │
│  │標高達成  │  │対戦の道  │  │特殊    │ │
│  │ルート    │  │ルート    │  │ルート  │ │
│  │  4/5    │  │  2/4    │  │  0/1  │ │
│  │         │  │         │  │        │ │
│  │  🚩     │  │  👑     │  │  🔒   │ │
│  │   |     │  │   |     │  │        │ │
│  │  ⛄     │  │  🏆     │  │        │ │
│  │   |     │  │   |     │  │        │ │
│  │  🏔️     │  │  🔒     │  │        │ │
│  │   |     │  │   |     │  │        │ │
│  │  👣     │  │  ⚔️     │  │        │ │
│  │   |     │  │         │  │        │ │
│  │  ━━━    │  │  ━━━    │  │  ━━━  │ │
│  └─────────┘  └─────────┘  └────────┘ │
│                                        │
│           [タイトルに戻る]              │
└────────────────────────────────────────┘
```

#### モバイル (sm以下)
- 1列表示（縦スクロール）
- ルートごとにセクション分け
- アコーディオン形式も検討

### カラー設計

```typescript
// ステップの状態別カラー
const stepColors = {
  unlocked: {
    bg: "bg-white/95",
    border: "border-yellow-400",
    text: "text-slate-900",
    connector: "bg-gradient-to-b from-yellow-400 to-yellow-500",
  },
  next: {
    bg: "bg-blue-50/95",
    border: "border-blue-400",
    text: "text-slate-900",
    connector: "bg-gradient-to-b from-gray-300 to-gray-400",
    pulse: "animate-pulse",
  },
  locked: {
    bg: "bg-slate-800/40",
    border: "border-slate-600/50",
    text: "text-slate-400",
    connector: "bg-gradient-to-b from-slate-600 to-slate-700",
  },
};
```

### アニメーション

1. **初期表示**: 下から順にフェードイン（stagger効果）
2. **ホバー**: スケール拡大 + 影強調
3. **接続線**: グラデーション + 微妙な光る効果
4. **次の目標**: パルスアニメーション

---

## 📝 実装タスク

### Phase 1: データ構造の拡張 (1-2h)
- [ ] `achievements.ts` に `category` と `order` を追加
- [ ] 既存の実績データにカテゴリと順序を設定
- [ ] `groupAchievementsByCategory()` 関数を実装
- [ ] TypeScript型定義の更新

### Phase 2: コンポーネント実装 (4-6h)
- [ ] `AchievementRoute.tsx` の実装
  - [ ] ルートタイトルと進捗表示
  - [ ] ステップのリスト表示（下から上）
- [ ] `AchievementStep.tsx` の実装
  - [ ] アイコンとタイトル表示
  - [ ] 3つの状態（解除済み/次の目標/ロック）の切り替え
  - [ ] ホバー時の詳細表示
- [ ] `RouteConnector.tsx` の実装
  - [ ] SVGまたはCSSでの接続線描画
  - [ ] 状態に応じたスタイル変更

### Phase 3: ページの再構築 (2-3h)
- [ ] `achievements/page.tsx` の大幅リファクタリング
  - [ ] 実績データをカテゴリ別にグループ化
  - [ ] 各カテゴリのルートをレンダリング
  - [ ] レスポンシブレイアウト（グリッド → 縦並び）
- [ ] 背景（空・山）のビジュアルは維持
- [ ] プログレスバーの位置調整または削除検討

### Phase 4: スタイリングと調整 (2-3h)
- [ ] Tailwind CSSでの詳細なスタイリング
- [ ] アニメーションの実装
- [ ] ホバー/タップのインタラクション
- [ ] レスポンシブ対応の確認

### Phase 5: テストと調整 (1-2h)
- [ ] 解除済み/未解除の表示確認
- [ ] 各デバイスサイズでの表示確認
- [ ] アクセシビリティチェック（フォーカス、キーボード操作）
- [ ] パフォーマンス確認

---

## 🧪 テスト項目

### 機能テスト
- [ ] 実績が正しくカテゴリ分けされている
- [ ] 順序が正しく表示される（下から上）
- [ ] 解除済み実績が正しく表示される
- [ ] 未解除実績がロック表示される
- [ ] 「次の目標」が正しくハイライトされる
- [ ] 進捗率が正しく計算される

### UI/UXテスト
- [ ] デスクトップで3列表示される
- [ ] タブレットで2列または1列表示される
- [ ] モバイルで1列表示される
- [ ] ホバー時に詳細が表示される
- [ ] アニメーションがスムーズ
- [ ] 背景（空・山）が適切に表示される

### アクセシビリティ
- [ ] キーボードでナビゲーション可能
- [ ] スクリーンリーダーで内容が読み上げられる
- [ ] コントラスト比が適切

---

## 📊 工数見積もり

| Phase | タスク | 見積時間 |
|-------|--------|----------|
| Phase 1 | データ構造の拡張 | 1-2h |
| Phase 2 | コンポーネント実装 | 4-6h |
| Phase 3 | ページの再構築 | 2-3h |
| Phase 4 | スタイリングと調整 | 2-3h |
| Phase 5 | テストと調整 | 1-2h |
| **合計** | | **10-16h** |

---

## 🎨 将来の拡張案

### 短期（実装後すぐ）
- [ ] 実績解除時のアニメーション（confetti効果）
- [ ] 詳細モーダルの実装
- [ ] 「達成までの進捗」表示（例: 7850/8000m）

### 中期（1-2ヶ月後）
- [ ] 実績のシェア機能（画像生成）
- [ ] ルートの分岐（複数の達成ルートを選べる）
- [ ] 隠し実績の追加

### 長期（3ヶ月以上）
- [ ] アニメーション付きの実績解除フロー
- [ ] ランキング連携（他のプレイヤーとの比較）
- [ ] カスタム実績の作成機能

---

## 📚 参考リソース

### デザイン参考
- **Steam実績**: 進捗表示とカテゴリ分け
- **Monument Valley**: 視覚的な高さの表現
- **Duolingo**: ステップ形式の学習パス

### 技術参考
- **SVG Path**: 曲線的な接続線の描画
- **CSS clip-path**: 独自の形状を作る
- **Framer Motion**: 複雑なアニメーション

---

## ✅ 完了条件

- [ ] すべての実績がルート型UIで表示される
- [ ] カテゴリごとにルートが分かれている
- [ ] 解除済み/次の目標/ロックの3状態が明確
- [ ] デスクトップとモバイルで適切に表示される
- [ ] 既存の機能（統計読み込み、タイトル遷移）が動作する
- [ ] パフォーマンスの劣化がない

---

## 📌 注意事項

### 既存機能の維持
- `loadUnlocked()`, `loadStats()` の利用は変更しない
- localStorage連携は既存のまま
- 背景の空・山のビジュアルは維持（調整は可）

### パフォーマンス
- 実績数が増えても対応できる設計
- アニメーションは過度にならないよう調整

### アクセシビリティ
- すべての情報がテキストでも取得可能
- キーボード操作に対応
- カラーだけに依存しない情報伝達

---

## 🚀 実装開始前のチェックリスト

- [ ] この計画について関係者の合意が得られている
- [ ] デザインモックアップを作成済み（推奨）
- [ ] 既存コードのバックアップまたはブランチ作成
- [ ] 必要なライブラリの確認（追加不要と想定）

---

**作成日**: 2026-02-21  
**対象バージョン**: v1.x  
**関連Issue**: （issueを作成後に記入）
