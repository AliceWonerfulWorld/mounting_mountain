# solo/page.tsx ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»

## ğŸ“‹ æ¦‚è¦

ç¾åœ¨ `src/app/solo/page.tsx` ã¯ **2623è¡Œ** ã®å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãªã£ã¦ãŠã‚Šã€ä¿å®ˆæ€§ãƒ»å¯èª­æ€§ãƒ»ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ã«èª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€é©åˆ‡ãªç²’åº¦ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã«åˆ†å‰²ã—ã€ä¿å®ˆã—ã‚„ã™ã„ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹è¨ˆç”»ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

---

## ğŸ¯ èƒŒæ™¯ãƒ»ç›®çš„

### ç¾çŠ¶ã®èª²é¡Œ
- âœ… **ãƒ†ã‚¹ãƒˆã§ä¿è­·æ¸ˆã¿**: issue #74ã§ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆã‚’å®Œäº†ï¼ˆ88.8%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
- âŒ **å·¨å¤§ãªãƒ•ã‚¡ã‚¤ãƒ«**: 2623è¡Œã®å˜ä¸€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- âŒ **è²¬å‹™ã®æ··åœ¨**: çŠ¶æ…‹ç®¡ç†ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€UIè¡¨ç¤ºãŒ1ãƒ•ã‚¡ã‚¤ãƒ«ã«é›†ç´„
- âŒ **ãƒ†ã‚¹ãƒˆå›°é›£**: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆãŒæ›¸ãã«ãã„æ§‹é€ 
- âŒ **å†åˆ©ç”¨ä¸å¯**: ãƒ­ã‚¸ãƒƒã‚¯ã‚„UIã®å†åˆ©ç”¨ãŒã§ããªã„

### ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œã®ç›®æ¨™
- âœ… **é©åˆ‡ãªç²’åº¦**: å„ãƒ•ã‚¡ã‚¤ãƒ«100-300è¡Œç¨‹åº¦ã«åˆ†å‰²
- âœ… **å˜ä¸€è²¬ä»»**: 1ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ1è²¬å‹™ã‚’å®Ÿç¾
- âœ… **ãƒ†ã‚¹ãƒˆå®¹æ˜“**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå˜ä½ã§ãƒ†ã‚¹ãƒˆå¯èƒ½
- âœ… **å†åˆ©ç”¨å¯èƒ½**: ãƒ­ã‚¸ãƒƒã‚¯ã¨UIã‚’ç‹¬ç«‹ã•ã›ã¦å†åˆ©ç”¨æ€§ã‚’å‘ä¸Š
- âœ… **å‹å®‰å…¨æ€§**: æ—¢å­˜ã®å‹å®šç¾©ã‚’æ´»ç”¨ã—ã€å‹å®‰å…¨æ€§ã‚’ç¶­æŒ

---

## ğŸ—‚ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¯¾è±¡

### å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `src/app/solo/page.tsx` (2623è¡Œ) â†’ **åˆ†å‰²å¯¾è±¡**

### ä¿æŒã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå¤‰æ›´ãªã—ï¼‰
- `src/lib/solo/score.ts` - ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒ†ã‚¹ãƒˆæ¸ˆã¿ï¼‰
- `src/lib/solo/bonus.ts` - ãƒœãƒ¼ãƒŠã‚¹è¨ˆç®—ï¼ˆãƒ†ã‚¹ãƒˆæ¸ˆã¿ï¼‰
- `src/lib/solo/missions.ts` - ãƒŸãƒƒã‚·ãƒ§ãƒ³è©•ä¾¡ï¼ˆãƒ†ã‚¹ãƒˆæ¸ˆã¿ï¼‰
- `src/lib/analyze/validator.ts` - AIå‡ºåŠ›æ¤œè¨¼ï¼ˆãƒ†ã‚¹ãƒˆæ¸ˆã¿ï¼‰

---

## ğŸ“¦ åˆ†å‰²è¨ˆç”»

### Phase 1: ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯åˆ†é›¢ï¼ˆçŠ¶æ…‹ç®¡ç†ï¼‰
**å„ªå…ˆåº¦: é«˜**

#### `src/hooks/useSoloGame.ts` (æ–°è¦ä½œæˆ)
ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ã‚’é›†ç´„

```typescript
export function useSoloGame() {
  // çŠ¶æ…‹
  const [game, setGame] = useState<GameState | null>(null);
  const [text, setText] = useState("");
  const [lastResult, setLastResult] = useState<Round | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // åˆæœŸåŒ–
  const initializeGame = useCallback(() => { /* ... */ }, []);
  
  // ãƒ©ã‚¦ãƒ³ãƒ‰é€ä¿¡
  const submitRound = useCallback(async () => { /* ... */ }, [game, text]);
  
  // æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸
  const proceedToNextRound = useCallback(() => { /* ... */ }, []);
  
  // ãƒªã‚»ãƒƒãƒˆ
  const resetGame = useCallback(() => { /* ... */ }, []);
  
  // ãƒ«ãƒ¼ãƒˆé¸æŠ
  const handleRouteSelect = useCallback((routeId: RouteId) => { /* ... */ }, []);

  return {
    game, text, setText, lastResult, loading, error,
    initializeGame, submitRound, proceedToNextRound, resetGame, handleRouteSelect
  };
}
```

**è²¬å‹™**: ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ãƒ»APIé€šä¿¡ãƒ»çŠ¶æ…‹æ›´æ–°

**æŠ½å‡ºã™ã‚‹æ©Ÿèƒ½**:
- ã‚²ãƒ¼ãƒ åˆæœŸåŒ–ï¼ˆãŠé¡Œé¸æŠã€å¤©å€™ã€ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼‰
- ãƒ©ã‚¦ãƒ³ãƒ‰é€ä¿¡ã¨APIé€šä¿¡
- ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ»ãƒœãƒ¼ãƒŠã‚¹é©ç”¨
- ä¿é™ºã‚·ã‚¹ãƒ†ãƒ 
- ãƒ©ã‚¦ãƒ³ãƒ‰é€²è¡Œãƒ»ã‚²ãƒ¼ãƒ çµ‚äº†åˆ¤å®š
- å®Ÿç¸¾æ›´æ–°

---

#### `src/hooks/useSoloCutins.ts` (æ–°è¦ä½œæˆ)
ã‚«ãƒƒãƒˆã‚¤ãƒ³æ¼”å‡ºã®çŠ¶æ…‹ç®¡ç†

```typescript
export function useSoloCutins() {
  const [showRoundCutin, setShowRoundCutin] = useState(false);
  const [showResultCutin, setShowResultCutin] = useState(false);
  const [showFallCutin, setShowFallCutin] = useState(false);
  const [showInsuranceCutin, setShowInsuranceCutin] = useState(false);
  const [cutinRoundNumber, setCutinRoundNumber] = useState(1);
  const [cutinTheme, setCutinTheme] = useState<0 | 1 | 2>(0);

  const triggerRoundCutin = useCallback((roundNumber: number) => { /* ... */ }, []);
  const triggerResultCutin = useCallback((result: MountResult) => { /* ... */ }, []);

  return {
    showRoundCutin, showResultCutin, showFallCutin, showInsuranceCutin,
    cutinRoundNumber, cutinTheme,
    triggerRoundCutin, triggerResultCutin
  };
}
```

**è²¬å‹™**: ã‚«ãƒƒãƒˆã‚¤ãƒ³æ¼”å‡ºã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ¶å¾¡

**æŠ½å‡ºã™ã‚‹æ©Ÿèƒ½**:
- ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹ã‚«ãƒƒãƒˆã‚¤ãƒ³
- çµæœè¡¨ç¤ºã‚«ãƒƒãƒˆã‚¤ãƒ³
- æ»‘è½ã‚«ãƒƒãƒˆã‚¤ãƒ³
- ä¿é™ºç²å¾—ã‚«ãƒƒãƒˆã‚¤ãƒ³
- ãƒ†ãƒ¼ãƒé¸æŠï¼ˆå±±å²³/ç©º/æ£®æ—ï¼‰

---

### Phase 2: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†é›¢
**å„ªå…ˆåº¦: é«˜**

#### `src/components/solo/MissionBriefingScreen.tsx` (æ–°è¦ä½œæˆ)
ãƒŸãƒƒã‚·ãƒ§ãƒ³èª¬æ˜ç”»é¢ï¼ˆç´„500è¡Œï¼‰

```typescript
type Props = {
  mission: Mission | undefined;
  weather: WeatherId | undefined;
  missionTheme: 0 | 1 | 2;
  onStart: () => void;
};

export function MissionBriefingScreen({ mission, weather, missionTheme, onStart }: Props) {
  // èƒŒæ™¯è£…é£¾ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆæ˜Ÿç©º/æœç„¼ã‘/é›ªå±±ï¼‰
  // ãƒŸãƒƒã‚·ãƒ§ãƒ³æƒ…å ±è¡¨ç¤º
  // å¤©å€™æƒ…å ±è¡¨ç¤º
  // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³
}
```

**è²¬å‹™**: ã‚²ãƒ¼ãƒ é–‹å§‹å‰ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³èª¬æ˜UI

**å«ã¾ã‚Œã‚‹è¦ç´ **:
- 3ç¨®é¡ã®èƒŒæ™¯ãƒ†ãƒ¼ãƒï¼ˆå¤œã®å±±ã¨æ˜Ÿç©º/æœç„¼ã‘ã®å±±/é›ªå±±ï¼‰
- ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜ãƒ»é”æˆæ¡ä»¶
- å¤©å€™æƒ…å ±ã¨ã‚¨ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³

---

#### `src/components/solo/SoloGameMain.tsx` (æ–°è¦ä½œæˆ)
ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ç”»é¢ï¼ˆç´„400è¡Œï¼‰

```typescript
type Props = {
  game: GameState;
  currentRound: Round;
  text: string;
  loading: boolean;
  error: string | null;
  onTextChange: (text: string) => void;
  onRouteSelect: (routeId: RouteId) => void;
  onSubmit: () => void;
};

export function SoloGameMain({ 
  game, currentRound, text, loading, error, 
  onTextChange, onRouteSelect, onSubmit 
}: Props) {
  // ãŠé¡Œè¡¨ç¤º
  // ãƒ«ãƒ¼ãƒˆé¸æŠUI
  // å…¥åŠ›ã‚¨ãƒªã‚¢
  // é€ä¿¡ãƒœã‚¿ãƒ³
  // ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±ï¼ˆãƒ©ã‚¦ãƒ³ãƒ‰æ•°ã€åˆè¨ˆæ¨™é«˜ã€å¤©å€™ï¼‰
}
```

**è²¬å‹™**: ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ä¸­ã®ãƒ¡ã‚¤ãƒ³UI

**å«ã¾ã‚Œã‚‹è¦ç´ **:
- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ©ã‚¦ãƒ³ãƒ‰ç•ªå·ã€åˆè¨ˆæ¨™é«˜ã€å¤©å€™ã€ãƒŸãƒƒã‚·ãƒ§ãƒ³é€²æ—ï¼‰
- ãŠé¡Œã‚«ãƒ¼ãƒ‰
- ãƒ«ãƒ¼ãƒˆé¸æŠãƒœã‚¿ãƒ³ï¼ˆSAFE/NORMAL/RISKYï¼‰
- ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ï¼ˆSoloInputAreaä½¿ç”¨ï¼‰
- é€ä¿¡ãƒœã‚¿ãƒ³
- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

---

#### `src/components/solo/SoloResultView.tsx` (æ–°è¦ä½œæˆ)
çµæœè¡¨ç¤ºç”»é¢ï¼ˆç´„300è¡Œï¼‰

```typescript
type Props = {
  round: Round;
  totalScore: number;
  isGameFinished: boolean;
  onNext: () => void;
  onReset: () => void;
};

export function SoloResultView({ 
  round, totalScore, isGameFinished, 
  onNext, onReset 
}: Props) {
  // æ¨™é«˜è¡¨ç¤ºï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰
  // DetailedMountainãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«
  // ãƒ©ãƒ™ãƒ«è¡¨ç¤º
  // ãƒœãƒ¼ãƒŠã‚¹ç†ç”±
  // ãƒ«ãƒ¼ãƒˆæƒ…å ±
  // å¤©å€™ãƒœãƒ¼ãƒŠã‚¹æƒ…å ±
  // æ¬¡ã¸/ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
}
```

**è²¬å‹™**: ãƒ©ã‚¦ãƒ³ãƒ‰çµæœãƒ»æœ€çµ‚çµæœã®è¡¨ç¤º

**å«ã¾ã‚Œã‚‹è¦ç´ **:
- ç²å¾—æ¨™é«˜ã®å¤§ããªè¡¨ç¤º
- å±±ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ï¼ˆDetailedMountainï¼‰
- ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒ³ã‚°ãƒ©ãƒ™ãƒ«è¡¨ç¤º
- ãƒœãƒ¼ãƒŠã‚¹ç†ç”±ã®è©³ç´°
- ãƒ«ãƒ¼ãƒˆå€ç‡ãƒ»å¤©å€™ãƒœãƒ¼ãƒŠã‚¹ã®å†…è¨³
- AIã‚³ãƒ¡ãƒ³ãƒˆãƒ»æ”»ç•¥ãƒ’ãƒ³ãƒˆ
- æ¬¡ã¸/æœ€çµ‚çµæœ/ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³

---

#### `src/components/solo/SoloHistoryPanel.tsx` (æ–°è¦ä½œæˆ)
å±¥æ­´ãƒ‘ãƒãƒ«ï¼ˆç´„200è¡Œï¼‰

```typescript
type Props = {
  rounds: Round[];
  isOpen: boolean;
  onToggle: () => void;
};

export function SoloHistoryPanel({ rounds, isOpen, onToggle }: Props) {
  // éå»ã®ãƒ©ã‚¦ãƒ³ãƒ‰è¡¨ç¤º
  // æŠ˜ã‚ŠãŸãŸã¿UI
  // å„ãƒ©ã‚¦ãƒ³ãƒ‰ã®æ¨™é«˜ãƒ»ãƒ©ãƒ™ãƒ«ãƒ»å…¥åŠ›å†…å®¹
}
```

**è²¬å‹™**: ãƒ—ãƒ¬ã‚¤å±¥æ­´ã®è¡¨ç¤º

**å«ã¾ã‚Œã‚‹è¦ç´ **:
- é–‹é–‰ãƒœã‚¿ãƒ³
- ãƒ©ã‚¦ãƒ³ãƒ‰å±¥æ­´ãƒªã‚¹ãƒˆï¼ˆãƒ©ã‚¦ãƒ³ãƒ‰ç•ªå·ã€æ¨™é«˜ã€ãƒ©ãƒ™ãƒ«ã€å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆï¼‰
- å°ã•ãªå±±ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«
- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ

---

#### `src/components/solo/WeatherDetailModal.tsx` (æ–°è¦ä½œæˆ)
å¤©æ°—è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆç´„150è¡Œï¼‰

```typescript
type Props = {
  weatherId: WeatherId;
  isOpen: boolean;
  onClose: () => void;
};

export function WeatherDetailModal({ weatherId, isOpen, onClose }: Props) {
  // å¤©æ°—æƒ…å ±è¡¨ç¤º
  // ãƒœãƒ¼ãƒŠã‚¹æ¡ä»¶è¡¨ç¤º
  // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
}
```

**è²¬å‹™**: å¤©æ°—è©³ç´°æƒ…å ±ã®è¡¨ç¤º

**å«ã¾ã‚Œã‚‹è¦ç´ **:
- å¤©å€™åãƒ»ã‚¨ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³
- åŠ¹æœèª¬æ˜
- ãƒœãƒ¼ãƒŠã‚¹å¯¾è±¡ãƒ©ãƒ™ãƒ«
- ãƒœãƒ¼ãƒŠã‚¹å€ç‡ï¼ˆ+20%ï¼‰
- é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³

---

#### ã‚«ãƒƒãƒˆã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¾¤ï¼ˆæ–°è¦ä½œæˆï¼‰
**å„80è¡Œç¨‹åº¦**

##### `src/components/solo/FallCutin.tsx`
æ»‘è½æ¼”å‡ºã‚«ãƒƒãƒˆã‚¤ãƒ³

```typescript
type Props = {
  show: boolean;
};

export function FallCutin({ show }: Props) {
  // æ»‘è½æ¼”å‡ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  // è­¦å‘Šè¡¨ç¤º
  // è‡ªå‹•ã§æ¶ˆãˆã‚‹
}
```

---

##### `src/components/solo/InsuranceCutin.tsx`
ä¿é™ºç²å¾—æ¼”å‡ºã‚«ãƒƒãƒˆã‚¤ãƒ³

```typescript
type Props = {
  show: boolean;
};

export function InsuranceCutin({ show }: Props) {
  // ä¿é™ºç²å¾—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  // åŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  // è‡ªå‹•ã§æ¶ˆãˆã‚‹
}
```

---

##### `src/components/solo/ResultCutin.tsx`
çµæœæ¼”å‡ºã‚«ãƒƒãƒˆã‚¤ãƒ³

```typescript
type Props = {
  show: boolean;
  altitude: number;
};

export function ResultCutin({ show, altitude }: Props) {
  // çµæœè¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  // æ¨™é«˜ã®å¼·èª¿è¡¨ç¤º
  // è‡ªå‹•ã§æ¶ˆãˆã‚‹
}
```

---

### Phase 3: æ–°ã—ã„page.tsxï¼ˆçµ±åˆï¼‰
**å„ªå…ˆåº¦: é«˜**

#### `src/app/solo/page.tsx` (ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œ)
**ç´„150-200è¡Œã«å‰Šæ¸›**

```typescript
"use client";

import { useState } from 'react';
import { useSoloGame } from '@/hooks/useSoloGame';
import { useSoloCutins } from '@/hooks/useSoloCutins';
import { MissionBriefingScreen } from '@/components/solo/MissionBriefingScreen';
import { SoloGameMain } from '@/components/solo/SoloGameMain';
import { SoloResultView } from '@/components/solo/SoloResultView';
import { SoloHistoryPanel } from '@/components/solo/SoloHistoryPanel';
import { WeatherDetailModal } from '@/components/solo/WeatherDetailModal';
import { RoundCutin } from '@/components/RoundCutin';
import { FallCutin } from '@/components/solo/FallCutin';
import { InsuranceCutin } from '@/components/solo/InsuranceCutin';
import { ResultCutin } from '@/components/solo/ResultCutin';

export default function SoloPage() {
  const gameHook = useSoloGame();
  const cutinHook = useSoloCutins();
  
  const [showMissionBriefing, setShowMissionBriefing] = useState(true);
  const [showingResult, setShowingResult] = useState(false);
  const [isHistoryOpen, setIsHistoryOpen] = useState(false);
  const [showWeatherDetail, setShowWeatherDetail] = useState(false);
  const [missionTheme] = useState(() => Math.floor(Math.random() * 3) as 0 | 1 | 2);

  const handleStart = () => {
    setShowMissionBriefing(false);
    cutinHook.triggerRoundCutin(1);
  };

  const handleSubmit = async () => {
    await gameHook.submitRound();
    setShowingResult(true);
  };

  const handleNext = () => {
    gameHook.proceedToNextRound();
    setShowingResult(false);
  };

  if (!gameHook.game) return <div>Loading...</div>;

  const currentRound = gameHook.game.players[0].rounds[gameHook.game.roundIndex];
  const isFinished = gameHook.game.status === 'finished';

  return (
    <main className="min-h-screen relative overflow-x-hidden">
      {/* ãƒŸãƒƒã‚·ãƒ§ãƒ³èª¬æ˜ç”»é¢ */}
      {showMissionBriefing && (
        <MissionBriefingScreen
          mission={gameHook.game.mission}
          weather={gameHook.game.weather}
          missionTheme={missionTheme}
          onStart={handleStart}
        />
      )}
      
      {/* ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ç”»é¢ */}
      {!showMissionBriefing && !showingResult && (
        <>
          <SoloGameMain
            game={gameHook.game}
            currentRound={currentRound}
            text={gameHook.text}
            loading={gameHook.loading}
            error={gameHook.error}
            onTextChange={gameHook.setText}
            onRouteSelect={gameHook.handleRouteSelect}
            onSubmit={handleSubmit}
          />
          
          <SoloHistoryPanel
            rounds={gameHook.game.players[0].rounds}
            isOpen={isHistoryOpen}
            onToggle={() => setIsHistoryOpen(!isHistoryOpen)}
          />
        </>
      )}
      
      {/* çµæœè¡¨ç¤ºç”»é¢ */}
      {showingResult && gameHook.lastResult && (
        <SoloResultView
          round={gameHook.lastResult}
          totalScore={gameHook.game.players[0].totalScore}
          isGameFinished={isFinished}
          onNext={handleNext}
          onReset={gameHook.resetGame}
        />
      )}
      
      {/* ã‚«ãƒƒãƒˆã‚¤ãƒ³æ¼”å‡º */}
      <RoundCutin
        show={cutinHook.showRoundCutin}
        roundNumber={cutinHook.cutinRoundNumber}
        theme={cutinHook.cutinTheme}
      />
      <FallCutin show={cutinHook.showFallCutin} />
      <InsuranceCutin show={cutinHook.showInsuranceCutin} />
      <ResultCutin
        show={cutinHook.showResultCutin}
        altitude={gameHook.lastResult?.result?.finalAltitude || 0}
      />
      
      {/* ãƒ¢ãƒ¼ãƒ€ãƒ« */}
      <WeatherDetailModal
        weatherId={gameHook.game.weather!}
        isOpen={showWeatherDetail}
        onClose={() => setShowWeatherDetail(false)}
      />
    </main>
  );
}
```

**è²¬å‹™**: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ»ç”»é¢é·ç§»åˆ¶å¾¡ã®ã¿

---

## ğŸš€ å®Ÿè£…æ‰‹é †

### Step 1: æº–å‚™
- [ ] æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒä½œæˆ: `git checkout -b refactor/solo-page-split`
- [ ] ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ:
  ```bash
  mkdir -p src/hooks
  mkdir -p src/components/solo
  ```

### Step 2: ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯åˆ†é›¢
- [ ] `src/hooks/useSoloGame.ts` ä½œæˆ
  - initializeGame, submitRound, proceedToNextRound, resetGame ã‚’ç§»è¡Œ
  - ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ: `npm run test:run`ï¼ˆæ—¢å­˜ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
- [ ] `src/hooks/useSoloCutins.ts` ä½œæˆ
  - ã‚«ãƒƒãƒˆã‚¤ãƒ³é–¢é€£ã®çŠ¶æ…‹ç®¡ç†ã‚’ç§»è¡Œ

### Step 3: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†é›¢ï¼ˆå„ªå…ˆé †ï¼‰
1. [ ] `MissionBriefingScreen.tsx` - ç‹¬ç«‹æ€§ãŒé«˜ã„
2. [ ] `WeatherDetailModal.tsx` - ç‹¬ç«‹æ€§ãŒé«˜ã„
3. [ ] `SoloHistoryPanel.tsx` - æ¯”è¼ƒçš„ç‹¬ç«‹
4. [ ] ã‚«ãƒƒãƒˆã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¾¤ï¼ˆFallCutin, InsuranceCutin, ResultCutinï¼‰
5. [ ] `SoloResultView.tsx` - çµæœè¡¨ç¤º
6. [ ] `SoloGameMain.tsx` - ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ 

### Step 4: page.tsxçµ±åˆ
- [ ] æ–°ã—ã„ `src/app/solo/page.tsx` ã‚’ä½œæˆ
- [ ] å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»é…ç½®
- [ ] ç”»é¢é·ç§»ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…

### Step 5: å‹•ä½œç¢ºèª
- [ ] é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•: `npm run dev`
- [ ] ã‚½ãƒ­ãƒ¢ãƒ¼ãƒ‰å…¨ä½“ã®å‹•ä½œç¢ºèª:
  - ãƒŸãƒƒã‚·ãƒ§ãƒ³èª¬æ˜ â†’ ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ â†’ çµæœè¡¨ç¤º
  - ãƒ«ãƒ¼ãƒˆé¸æŠï¼ˆSAFE/NORMAL/RISKYï¼‰
  - æ»‘è½ãƒ»ä¿é™ºã®å‹•ä½œ
  - å¤©å€™ãƒœãƒ¼ãƒŠã‚¹
  - å±¥æ­´è¡¨ç¤º
  - å¤©å€™è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«
  - ã‚«ãƒƒãƒˆã‚¤ãƒ³æ¼”å‡º
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ: `npm run test:run`
- [ ] å‹ãƒã‚§ãƒƒã‚¯: `npx tsc --noEmit`
- [ ] Lint: `npm run lint`

### Step 6: PRä½œæˆ
- [ ] ã‚³ãƒŸãƒƒãƒˆ: `git commit -m "refactor: split solo/page.tsx into components and hooks"`
- [ ] ãƒ—ãƒƒã‚·ãƒ¥: `git push origin refactor/solo-page-split`
- [ ] PRä½œæˆï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½¿ç”¨ï¼‰

---

## âœ… å®Œäº†æ¡ä»¶

- [ ] `src/app/solo/page.tsx` ãŒ200è¡Œä»¥ä¸‹ã«ãªã£ã¦ã„ã‚‹
- [ ] å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ100-300è¡Œã®é©åˆ‡ãªç²’åº¦
- [ ] å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ï¼ˆ120ãƒ†ã‚¹ãƒˆï¼‰
- [ ] å‹ã‚¨ãƒ©ãƒ¼ãªã—
- [ ] Lintã‚¨ãƒ©ãƒ¼ãªã—
- [ ] ã‚½ãƒ­ãƒ¢ãƒ¼ãƒ‰å…¨æ©Ÿèƒ½ãŒæ­£å¸¸å‹•ä½œ
- [ ] æ—¢å­˜ã®UIã¨åŒã˜è¦‹ãŸç›®ãƒ»å‹•ä½œ

---

## ğŸ“Š åˆ†å‰²å‰å¾Œã®æ¯”è¼ƒ

### Beforeï¼ˆç¾çŠ¶ï¼‰
```
src/app/solo/page.tsx                    2623è¡Œ
```

### Afterï¼ˆç›®æ¨™ï¼‰
```
src/app/solo/page.tsx                     150-200è¡Œ
src/hooks/useSoloGame.ts                  250-300è¡Œ
src/hooks/useSoloCutins.ts                100-150è¡Œ
src/components/solo/MissionBriefingScreen.tsx    500è¡Œ
src/components/solo/SoloGameMain.tsx             400è¡Œ
src/components/solo/SoloResultView.tsx           300è¡Œ
src/components/solo/SoloHistoryPanel.tsx         200è¡Œ
src/components/solo/WeatherDetailModal.tsx       150è¡Œ
src/components/solo/FallCutin.tsx                 80è¡Œ
src/components/solo/InsuranceCutin.tsx            80è¡Œ
src/components/solo/ResultCutin.tsx               80è¡Œ
---------------------------------------------------
åˆè¨ˆ                                     ç´„2490è¡Œ
```

**åŠ¹æœ**:
- ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ93%å‰Šæ¸›ï¼ˆ2623è¡Œ â†’ 150-200è¡Œï¼‰
- é©åˆ‡ãªç²’åº¦ã§åˆ†å‰²ï¼ˆå„ãƒ•ã‚¡ã‚¤ãƒ«80-500è¡Œï¼‰
- å†åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»ãƒ•ãƒƒã‚¯ã®ç²å¾—

---

## ğŸ“š å‚è€ƒæƒ…å ±

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [test-implementation-plan.md](./test-implementation-plan.md) - ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
- [solo-mode-implementation.md](./solo-mode-implementation.md) - ã‚½ãƒ­ãƒ¢ãƒ¼ãƒ‰ä»•æ§˜

### æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `src/components/SoloInputArea.tsx` - å…¥åŠ›ã‚¨ãƒªã‚¢ã®æ—¢å­˜å®Ÿè£…
- `src/components/RoundCutin.tsx` - ã‚«ãƒƒãƒˆã‚¤ãƒ³ã®æ—¢å­˜å®Ÿè£…
- `src/components/DetailedMountain.tsx` - å±±ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«

### å‹å®šç¾©
- `src/types/game.ts` - GameState, Round, Player
- `src/types/mount.ts` - MountResult
- `src/lib/solo/routes.ts` - RouteId
- `src/lib/solo/weather.ts` - WeatherId
- `src/lib/solo/missions.ts` - Mission, MissionId

---

## ğŸ’¡ è¨­è¨ˆåŸå‰‡

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ
1. **å˜ä¸€è²¬ä»»ã®åŸå‰‡**: 1ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ1è²¬å‹™
2. **Propsè¨­è¨ˆ**: å¿…è¦æœ€å°é™ã®propsã‚’å—ã‘å–ã‚‹
3. **å‹å®‰å…¨**: ã™ã¹ã¦ã®propsã«å‹ã‚’å®šç¾©
4. **Pure Component**: å‰¯ä½œç”¨ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹

### ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯è¨­è¨ˆ
1. **å‘½åè¦å‰‡**: `use` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å¿…ãšä»˜ã‘ã‚‹
2. **æˆ»ã‚Šå€¤**: æ˜ç¢ºãªåå‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¿”ã™
3. **ä¾å­˜é–¢ä¿‚**: ä¾å­˜é…åˆ—ã‚’æ˜ç¤ºçš„ã«ç®¡ç†
4. **å†åˆ©ç”¨æ€§**: è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å…±æœ‰å¯èƒ½ãªè¨­è¨ˆ

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ solo/
â”‚       â””â”€â”€ page.tsx              # çµ±åˆãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”œâ”€â”€ components/
â”‚   â””â”€â”€ solo/                     # ã‚½ãƒ­ãƒ¢ãƒ¼ãƒ‰å°‚ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚       â”œâ”€â”€ MissionBriefingScreen.tsx
â”‚       â”œâ”€â”€ SoloGameMain.tsx
â”‚       â”œâ”€â”€ SoloResultView.tsx
â”‚       â”œâ”€â”€ SoloHistoryPanel.tsx
â”‚       â”œâ”€â”€ WeatherDetailModal.tsx
â”‚       â”œâ”€â”€ FallCutin.tsx
â”‚       â”œâ”€â”€ InsuranceCutin.tsx
â”‚       â””â”€â”€ ResultCutin.tsx
â””â”€â”€ hooks/
    â”œâ”€â”€ useSoloGame.ts            # ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†
    â””â”€â”€ useSoloCutins.ts          # ã‚«ãƒƒãƒˆã‚¤ãƒ³æ¼”å‡ºç®¡ç†
```

---

## ğŸ› æ³¨æ„ç‚¹ãƒ»è½ã¨ã—ç©´

### 1. çŠ¶æ…‹ã®å…±æœ‰
- ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã§çŠ¶æ…‹ã‚’é›†ç´„ã—ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§å…±æœ‰
- Propsãƒ‰ãƒªãƒªãƒ³ã‚°ã‚’é¿ã‘ã‚‹ãŸã‚ã€å¿…è¦æœ€å°é™ã®propsã®ã¿æ¸¡ã™

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- `useCallback`, `useMemo` ã‚’é©åˆ‡ã«ä½¿ç”¨
- é‡ã„è¨ˆç®—ã¯ useMemo ã§ãƒ¡ãƒ¢åŒ–
- ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã¯ useCallback ã§ãƒ¡ãƒ¢åŒ–

### 3. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- framer-motion ã® AnimatePresence ã‚’é©åˆ‡ã«é…ç½®
- ã‚«ãƒƒãƒˆã‚¤ãƒ³æ¼”å‡ºã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ­£ç¢ºã«åˆ¶å¾¡

### 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- APIé€šä¿¡ã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«ã‚­ãƒ£ãƒƒãƒãƒ»è¡¨ç¤º
- LoadingçŠ¶æ…‹ã®ç®¡ç†

### 5. å‹å®‰å…¨æ€§
- ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆpropsã«å‹ã‚’å®šç¾©
- æ—¢å­˜ã®å‹å®šç¾©ã‚’æœ€å¤§é™æ´»ç”¨
- `any` ã®ä½¿ç”¨ã‚’é¿ã‘ã‚‹

---

## ğŸ“ å®Ÿè£…ä¾‹

### useSoloGame.ts ã®å®Ÿè£…ä¾‹ï¼ˆæŠœç²‹ï¼‰

```typescript
import { useState, useCallback } from 'react';
import type { GameState, Round } from '@/types/game';
import type { RouteId } from '@/lib/solo/routes';
import { pickN } from '@/lib/random';
import { PROMPTS } from '@/lib/prompts';
import { createRounds } from '@/lib/game';
import { pickWeather } from '@/lib/solo/weather';
import { pickMission } from '@/lib/solo/missions';
import { computeBonus } from '@/lib/solo/bonus';
import { getRoute } from '@/lib/solo/routes';
import { computeFinalAltitude } from '@/lib/solo/score';
import { updateStats } from '@/lib/achievementStore';

export function useSoloGame() {
  const ROUND_COUNT = 3;
  
  const [game, setGame] = useState<GameState | null>(null);
  const [text, setText] = useState("");
  const [lastResult, setLastResult] = useState<Round | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const initializeGame = useCallback(() => {
    const selectedPrompts = pickN(PROMPTS, ROUND_COUNT).map((p) => p.text);
    const rounds = createRounds(selectedPrompts, ROUND_COUNT);
    const weather = pickWeather();
    const mission = pickMission();

    const newGame: GameState = {
      mode: "solo",
      status: "playing",
      roundIndex: 0,
      prompts: rounds.map((r) => r.prompt),
      weather: weather.id,
      mission,
      insurance: 0,
      players: [{
        id: "p1",
        name: "Player 1",
        totalScore: 0,
        rounds,
      }],
    };

    setGame(newGame);
    setText("");
    setLastResult(null);
    setError(null);
  }, []);

  const submitRound = useCallback(async () => {
    if (!game || !text.trim() || loading) return;

    const currentRound = game.players[0].rounds[game.roundIndex];
    
    setLoading(true);
    setError(null);

    try {
      const res = await fetch("/api/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          text: text.trim(),
          route: currentRound.routeId || "NORMAL"
        }),
      });

      if (!res.ok) {
        throw new Error(`API Error: ${res.status}`);
      }

      const result = await res.json();

      setGame((prev) => {
        if (!prev) return null;
        const next = structuredClone(prev);
        const player = next.players[0];
        const round = player.rounds[next.roundIndex];

        round.inputText = text.trim();

        const route = getRoute(round.routeId);
        const bonus = computeBonus(result.labels);
        
        const scoreResult = computeFinalAltitude({
          baseAltitude: result.altitude,
          routeId: round.routeId || "NORMAL",
          routeMultiplier: route.multiplier,
          bonusAltitude: bonus.bonusAltitude,
          weatherId: prev.weather,
          labels: result.labels,
          insurance: prev.insurance,
        });

        round.result = {
          ...result,
          ...scoreResult,
          bonusReasons: bonus.reasons,
        };

        if (scoreResult.insuranceUsed) {
          next.insurance = Math.max(0, prev.insurance - 1);
        }

        if (round.routeId === "SAFE") {
          next.insurance = Math.min(1, next.insurance + 1);
        }

        player.totalScore += scoreResult.finalAltitude;

        updateStats({
          highestAltitude: scoreResult.finalAltitude,
          snowCount: scoreResult.finalAltitude >= 6000 ? 1 : 0,
          everestCount: scoreResult.finalAltitude >= 8000 ? 1 : 0,
        });

        setLastResult(structuredClone(round));

        return next;
      });

      setText("");
    } catch (e) {
      setError(e instanceof Error ? e.message : "Unknown error");
    } finally {
      setLoading(false);
    }
  }, [game, text, loading]);

  const proceedToNextRound = useCallback(() => {
    setGame((prev) => {
      if (!prev) return null;
      const next = structuredClone(prev);

      if (next.roundIndex + 1 >= next.players[0].rounds.length) {
        next.status = "finished";
        updateStats({
          soloPlays: 1,
          highestTotalAltitude: next.players[0].totalScore,
        });
      } else {
        next.roundIndex += 1;
      }

      return next;
    });
  }, []);

  const resetGame = useCallback(() => {
    initializeGame();
  }, [initializeGame]);

  const handleRouteSelect = useCallback((routeId: RouteId) => {
    setGame((prev) => {
      if (!prev) return null;
      const next = structuredClone(prev);
      next.players[0].rounds[next.roundIndex].routeId = routeId;
      return next;
    });
  }, []);

  return {
    game,
    text,
    setText,
    lastResult,
    loading,
    error,
    initializeGame,
    submitRound,
    proceedToNextRound,
    resetGame,
    handleRouteSelect,
  };
}
```

---

## ğŸ¯ ã¾ã¨ã‚

ã“ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»ã«å¾“ã†ã“ã¨ã§ï¼š

1. **ä¿å®ˆæ€§ã®å‘ä¸Š**: å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ«ãŒé©åˆ‡ãªç²’åº¦ã«åˆ†å‰²ã•ã‚Œã‚‹
2. **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå˜ä½ã§ãƒ†ã‚¹ãƒˆå¯èƒ½ã«ãªã‚‹
3. **å†åˆ©ç”¨æ€§**: ãƒ­ã‚¸ãƒƒã‚¯ã¨UIãŒç‹¬ç«‹ã—ã€å†åˆ©ç”¨å¯èƒ½ã«ãªã‚‹
4. **å¯èª­æ€§**: å„ãƒ•ã‚¡ã‚¤ãƒ«ã®è²¬å‹™ãŒæ˜ç¢ºã«ãªã‚Šã€ç†è§£ã—ã‚„ã™ããªã‚‹
5. **å‹å®‰å…¨æ€§**: æ—¢å­˜ã®å‹å®šç¾©ã‚’æ´»ç”¨ã—ã€å‹å®‰å…¨æ€§ã‚’ç¶­æŒ

æ®µéšçš„ã«é€²ã‚ã‚‹ã“ã¨ã§ã€æ—¢å­˜æ©Ÿèƒ½ã‚’å£Šã•ãšã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’å®Œäº†ã§ãã¾ã™ã€‚
